document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector('a[href*="security.logs.export"]');e&&e.addEventListener("click",function(r){r.preventDefault();const s=e.innerHTML;e.innerHTML='<i class="ri-loader-4-line me-1 animate-spin"></i>جاري التصدير...',e.classList.add("disabled"),fetch(e.href).then(n=>n.json()).then(n=>{const c=l(n),t=new Blob([c],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),i=URL.createObjectURL(t);o.setAttribute("href",i),o.setAttribute("download",`security-logs-${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(o),o.click(),document.body.removeChild(o),e.innerHTML=s,e.classList.remove("disabled")}).catch(n=>{console.error("Error exporting logs:",n),e.innerHTML=s,e.classList.remove("disabled"),alert("حدث خطأ أثناء تصدير السجلات. يرجى المحاولة مرة أخرى.")})})});function l(e){if(!e||!e.length)return"";const r=Object.keys(e[0]);return["\uFEFF"+r.join(","),...e.map(n=>r.map(c=>{let t=n[c]||"";return t=t.toString().replace(/"/g,'""'),(t.includes(",")||t.includes(`
`))&&(t=`"${t}"`),t}).join(","))].join(`
`)}
